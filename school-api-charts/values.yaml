# Global configuration
namespace: school-api

# API Deployment
api:
  replicaCount: 1
  image: rivindu02/school-management-api:latest
  imagePullPolicy: Always
  port: 3000
  nodePort: 30080
  nodeEnv: production
  
  # Health check configuration
  healthChecks:
    enabled: true
    path: /health
    startup:
      initialDelaySeconds: 15
      periodSeconds: 5
      timeoutSeconds: 3
      failureThreshold: 15
    liveness:
      initialDelaySeconds: 45
      periodSeconds: 15
      timeoutSeconds: 5
      failureThreshold: 3
    readiness:
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 3
      failureThreshold: 3
  
  resources:
    requests:
      cpu: "50m"
      memory: "128Mi"
    limits:
      cpu: "300m"
      memory: "384Mi"

# MongoDB Configuration (Bitnami from Artifact Hub)
mongodb:
  enabled: true  # Toggle: true=Bitnami chart, false=manual deployment
  
  # Image configuration - using latest stable
  image:
    registry: registry-1.docker.io
    repository: bitnami/mongodb
    tag: 8.0.4-debian-12-r3
    pullPolicy: IfNotPresent
  
  # Authentication
  auth:
    enabled: true
    rootUser: admin
    rootPassword: "xY3zA5bC8dE0fG2hI4jK6lM8n9oP1q"
  
  # Architecture
  architecture: standalone
  useStatefulSet: false  # Use Deployment instead for standalone
  
  # Persistence
  persistence:
    enabled: true
    storageClass: "microk8s-hostpath"  # Explicit storage class for MicroK8s
    size: 1Gi
    accessModes:
      - ReadWriteOnce
  
  # Resource limits (required by ResourceQuota)
  resources:
    requests:
      cpu: "100m"
      memory: "256Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"
  
  # Disable problematic init containers
  volumePermissions:
    enabled: false
  
  # Security contexts - disabled for compatibility
  containerSecurityContext:
    enabled: false
  podSecurityContext:
    enabled: false
  
  # Service configuration
  fullnameOverride: "mongo-service"
  
  # Disable arbiter for standalone
  arbiter:
    enabled: false
  
  # Network policy
  networkPolicy:
    enabled: false
  
  # Metrics disabled
  metrics:
    enabled: false

# Secrets (In production --> use SealedSecrets or Vault)
secrets:
  jwtSecret: "8fH2jK9mP4qR7sT1vW6xY3zA5bC8dE0fG2hI4jK6lM8n"
  mongoUsername: "admin"
  mongoPassword: "xY3zA5bC8dE0fG2hI4jK6lM8n9oP1q"

# Ingress configuration
ingress:
  enabled: true
  className: public
  host: school-api.local
  path: /
  pathType: Prefix
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /

# Resource Quota
resourceQuota:
  enabled: true
  requests:
    cpu: "400m"
    memory: "1Gi"
  limits:
    cpu: "1000m"
    memory: "2Gi"
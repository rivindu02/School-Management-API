# Helm Chart Architecture

## Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Kubernetes Cluster                         â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Namespace: school-api                   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚   Ingress (Optional)     â”‚  â”‚   ResourceQuota         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  school-api.local        â”‚  â”‚   CPU: 400m / 1000m     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  /api/* â†’ API Service    â”‚  â”‚   Mem: 1Gi / 2Gi        â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚             â”‚                                              â”‚ â”‚
â”‚  â”‚             â–¼                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚  â”‚  â”‚  Service: school-api-service (NodePort)      â”‚          â”‚ â”‚
â”‚  â”‚  â”‚  Type: NodePort                              â”‚          â”‚ â”‚
â”‚  â”‚  â”‚  Port: 80 â†’ TargetPort: 3000                 â”‚          â”‚ â”‚
â”‚  â”‚  â”‚  NodePort: 30080                             â”‚          â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â”‚  â”‚             â”‚                                              â”‚ â”‚
â”‚  â”‚             â–¼                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚ â”‚
â”‚  â”‚  â”‚  Deployment: school-api (1-3 replicas)      â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Pod: school-api-xxx                   â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Container: school-api           â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Image: rivindu02/school-*:*     â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Port: 3000                      â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  User: 1001 (non-root)           â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚                                  â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Health Checks:                  â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  âœ“ Startup Probe: /health        â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  âœ“ Liveness Probe: /health       â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  âœ“ Readiness Probe: /health      â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚                                  â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Env from:                       â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - ConfigMap: school-api-config  â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - Secret: school-api-secret     â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ â”‚
â”‚  â”‚                   â”‚                                        â”‚ â”‚
â”‚  â”‚                   â”‚ MongoDB Connection                     â”‚ â”‚
â”‚  â”‚                   â”‚ mongodb://mongo-service:27017          â”‚ â”‚
â”‚  â”‚                   â”‚                                        â”‚ â”‚
â”‚  â”‚                   â–¼                                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚  â”‚  â”‚  Service: mongo-service (ClusterIP)          â”‚          â”‚ â”‚
â”‚  â”‚  â”‚  Type: ClusterIP (internal only)             â”‚          â”‚ â”‚
â”‚  â”‚  â”‚  Port: 27017 â†’ TargetPort: 27017             â”‚          â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â”‚  â”‚             â”‚                                              â”‚ â”‚
â”‚  â”‚             â–¼                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚ â”‚
â”‚  â”‚  â”‚  Deployment: mongo (1 replica)              â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Pod: mongo-xxx                        â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Container: mongo                â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Image: mongo:7.0-jammy          â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Port: 27017                     â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚                                  â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Health Checks:                  â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  âœ“ Liveness: mongosh ping        â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  âœ“ Readiness: mongosh ping       â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚                                  â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Volumes:                        â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - mongo-storage (PVC)           â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  - mongo-config (emptyDir)       â”‚  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ â”‚
â”‚  â”‚                   â”‚                                        â”‚ â”‚
â”‚  â”‚                   â–¼                                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚  â”‚  â”‚  PersistentVolumeClaim: mongo-pvc            â”‚          â”‚ â”‚
â”‚  â”‚  â”‚  StorageClass: microk8s-hostpath             â”‚          â”‚ â”‚
â”‚  â”‚  â”‚  Size: 1Gi                                   â”‚          â”‚ â”‚
â”‚  â”‚  â”‚  AccessMode: ReadWriteOnce                   â”‚          â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â”‚  â”‚             â”‚                                              â”‚ â”‚
â”‚  â”‚             â–¼                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚  â”‚  â”‚  PersistentVolume (Dynamic)                  â”‚          â”‚ â”‚
â”‚  â”‚  â”‚  Provisioned by StorageClass                 â”‚          â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚  â”‚  â”‚  ConfigMap: school-api-config                â”‚          â”‚ â”‚
â”‚  â”‚  â”‚  - NODE_ENV: production                      â”‚          â”‚ â”‚
â”‚  â”‚  â”‚  - MONGO_URI: mongodb://mongo-service...     â”‚          â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚  â”‚  â”‚  Secret: school-api-secret                   â”‚          â”‚ â”‚
â”‚  â”‚  â”‚  - jwt-secret                                â”‚          â”‚ â”‚
â”‚  â”‚  â”‚  - mongo-root-username                       â”‚          â”‚ â”‚
â”‚  â”‚  â”‚  - mongo-root-password                       â”‚          â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Traffic Flow

### External Request Flow
```
User/Client
    â”‚
    â–¼
NodePort :30080 (External Access)
    â”‚
    â–¼
school-api-service (NodePort Service)
    â”‚
    â–¼
school-api Pod (Port 3000)
    â”‚
    â–¼
Application Logic
    â”‚
    â–¼
mongo-service:27017 (ClusterIP Service)
    â”‚
    â–¼
MongoDB Pod (Port 27017)
    â”‚
    â–¼
Persistent Volume (Data Storage)
```

### Ingress Flow (Optional)
```
User/Client (browser)
    â”‚
    â–¼
Ingress Controller (school-api.local)
    â”‚
    â–¼
school-api-service:80
    â”‚
    â–¼
school-api Pod:3000
```



##  Helm Chart Components

```
school-api-charts/
â”‚
â”œâ”€â”€ Chart.yaml              # Metadata (name, version, description)
â”œâ”€â”€ values.yaml             # Default configuration values
â”‚
â”œâ”€â”€ values-dev.yaml         # Development environment
â”œâ”€â”€ values-staging.yaml     # Staging environment
â””â”€â”€ values-prod.yaml        # Production environment
â”‚
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ namespace.yaml      # Creates isolated namespace
â”‚   â”œâ”€â”€ configmap-secret.yaml  # Configuration & sensitive data
â”‚   â”œâ”€â”€ api-deployment.yaml    # API pods + Service
â”‚   â”œâ”€â”€ mongodb.yaml           # MongoDB + PVC + Service
â”‚   â”œâ”€â”€ ingress.yaml           # HTTP routing (conditional)
â”‚   â””â”€â”€ resourcequota.yaml     # Resource limits (conditional)
â”‚
â”œâ”€â”€ README.md               # documentation
â””â”€â”€ .helmignore            # Package exclusions
```

## Key Design Decisions

1. **Namespace Isolation**: Each deployment in its own namespace
2. **Health Checks**: All pods have comprehensive health monitoring
3. **Security First**: Non-root containers, dropped capabilities
4. **Flexible Storage**: Configurable storage class for different environments
5. **Environment-Specific**: Separate values files for dev/staging/prod
6. **Optional Components**: Ingress and ResourceQuota can be disabled
7. **ConfigMap + Secrets**: Proper separation of configuration vs sensitive data
8. **Named Ports**: Better documentation and service mesh compatibility
